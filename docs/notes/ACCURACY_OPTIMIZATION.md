# å€™é€‰é›†é¢„ç­›é€‰æ€§èƒ½åˆ†æä¸å‡†ç¡®ç‡ä¼˜åŒ–å»ºè®®

## ğŸ“Š æµ‹è¯•ç»“æœæ€»ç»“

### æ€§èƒ½å¯¹æ¯”

| ç‰ˆæœ¬ | æ£€ç´¢é€Ÿåº¦ | LLMå‡†ç¡®ç‡ | Containå‡†ç¡®ç‡ | æé€Ÿå€æ•° |
|------|---------|----------|--------------|---------|
| **å‚æ•°ä¼˜åŒ–** | 13.9ç§’ | **73.0%** | 34.0% | åŸºçº¿ |
| **å€™é€‰é›†é¢„ç­›é€‰** | **1.5ç§’** | 70.0% | **35.0%** | **9.2x** |

### å…³é”®å‘ç°

âœ… **é€Ÿåº¦ä¼˜åŒ–æå…¶æˆåŠŸ**
- ä»13.9ç§’é™åˆ°1.5ç§’ï¼Œæé€Ÿ9.2å€
- ç›¸æ¯”åŸå§‹90ç§’ï¼Œæ€»æé€Ÿ60å€ï¼
- å®Œæˆ1273ä¸ªé—®é¢˜åªéœ€32åˆ†é’Ÿï¼ˆåŸéœ€53å°æ—¶ï¼‰

âš ï¸ **å‡†ç¡®ç‡å°å¹…ä¸‹é™**
- LLMå‡†ç¡®ç‡: 73% â†’ 70% (ä¸‹é™3%)
- Containå‡†ç¡®ç‡: 34% â†’ 35% (æå‡1%)

---

## ğŸ¯ å‡†ç¡®ç‡ä¼˜åŒ–ç­–ç•¥

### é—®é¢˜è¯Šæ–­

**å€™é€‰æ± å¤§å°ä¸è¶³**ï¼šå½“å‰åªå–top-200ä¸ªpassageï¼Œå¯èƒ½é—æ¼ç›¸å…³æ–‡æ¡£
- 73% â†’ 70%çš„ä¸‹é™è¡¨æ˜å€™é€‰æ± è¿‡å°
- éœ€è¦åœ¨é€Ÿåº¦å’Œå‡†ç¡®ç‡é—´æ‰¾åˆ°å¹³è¡¡ç‚¹

### ä¼˜åŒ–æ–¹æ¡ˆ

#### æ–¹æ¡ˆA: æ‰©å¤§å€™é€‰æ±  (æ¨èâ­â­â­â­â­)

**æ“ä½œ**: å¢åŠ å€™é€‰æ± å¤§å°ä»200åˆ°500

```python
# src/config.py
candidate_pool_size=500,  # åŸå€¼: 200
```

**é¢„æœŸæ•ˆæœ**:
- å‡†ç¡®ç‡: 70% â†’ 72-73% (æ¢å¤åˆ°åŸæ°´å¹³)
- é€Ÿåº¦: 1.5ç§’ â†’ 3-4ç§’ (ä»æ¯”13.9ç§’å¿«3-4å€)
- **æ¨èåº¦**: â­â­â­â­â­

---

#### æ–¹æ¡ˆB: æ··åˆæ£€ç´¢ç­–ç•¥ (â­â­â­â­)

**åŸç†**: ç»“åˆå€™é€‰é›†è¿‡æ»¤å’Œå…¨å›¾æœç´¢çš„ä¼˜åŠ¿

```python
# src/LinearRAG.py ä¿®æ”¹ graph_search_with_seed_entities

def graph_search_with_seed_entities(self, ...):
    # 1. å…ˆç”¨å€™é€‰é›†å¿«é€Ÿæœç´¢
    if has_many_entities(seed_entities) or is_complex_query(question):
        # å¤æ‚æŸ¥è¯¢: ä½¿ç”¨æ›´å¤§å€™é€‰é›†
        candidate_size = 500
    else:
        # ç®€å•æŸ¥è¯¢: ä½¿ç”¨å°å€™é€‰é›†
        candidate_size = 200
```

**é¢„æœŸæ•ˆæœ**:
- å‡†ç¡®ç‡: 70% â†’ 71-72%
- å¹³å‡é€Ÿåº¦: 1.5ç§’ â†’ 2-3ç§’
- **æ¨èåº¦**: â­â­â­â­

---

#### æ–¹æ¡ˆC: ä¼˜åŒ–å®ä½“æ‰©æ•£è´¨é‡ (â­â­â­)

**é—®é¢˜**: å½“å‰å¯èƒ½æ‰©æ•£åˆ°ä¸ç›¸å…³å®ä½“

**æ”¹è¿›ç‚¹**:
1. **æé«˜å¥å­ç›¸ä¼¼åº¦é˜ˆå€¼**
```python
# åœ¨ calculate_entity_scores ä¸­
if top_sentence_score < 0.3:  # æ·»åŠ é˜ˆå€¼è¿‡æ»¤
    continue
```

2. **é™åˆ¶ä½å±‚çº§å®ä½“çš„æƒé‡**
```python
# é™ä½tier>1çš„å®ä½“æƒé‡
if tier > 1:
    next_entity_score *= 0.7  # è¡°å‡å› å­
```

**é¢„æœŸæ•ˆæœ**:
- å‡†ç¡®ç‡: 70% â†’ 71%
- é€Ÿåº¦: ä¿æŒ1.5ç§’
- **æ¨èåº¦**: â­â­â­

---

#### æ–¹æ¡ˆD: ä¸¤é˜¶æ®µæ£€ç´¢ (â­â­â­â­)

**ç­–ç•¥**: å€™é€‰é›†ç²—æ’ + ç²¾ç»†é‡æ’

```python
def graph_search_with_seed_entities(self, ...):
    # Stage 1: å€™é€‰é›†ç²—æ’ (top-200)
    quick_results = fast_search(candidate_pool_size=200)
    
    # Stage 2: å¦‚æœç§å­å®ä½“è¾ƒå¤šï¼Œæ‰©å±•æœç´¢
    if len(seed_entities) >= 3:
        extended_results = extended_search(
            candidate_pool_size=500,
            focus_on=quick_results[:10]  # å›´ç»•top-10æ‰©å±•
        )
        return extended_results
    
    return quick_results
```

**é¢„æœŸæ•ˆæœ**:
- å‡†ç¡®ç‡: 70% â†’ 72%
- å¹³å‡é€Ÿåº¦: 1.5ç§’ â†’ 2ç§’
- **æ¨èåº¦**: â­â­â­â­

---

## ğŸš€ ç«‹å³å®æ–½å»ºè®®

### æ¨èæ–¹æ¡ˆ: A + C ç»„åˆ

**æ­¥éª¤1**: æ‰©å¤§å€™é€‰æ± åˆ°500
```python
# src/config.py ç¬¬20è¡Œ
candidate_pool_size=500,  # ä»200æ”¹ä¸º500
```

**æ­¥éª¤2**: æ·»åŠ å¥å­ç›¸ä¼¼åº¦è¿‡æ»¤
```python
# src/LinearRAG.py calculate_entity_scores æ–¹æ³•ä¸­
# åœ¨ for top_sentence_index in top_sentence_indices: å¾ªç¯å†…æ·»åŠ 
top_sentence_score = sentence_similarities[top_sentence_index]

# âœ… æ·»åŠ é˜ˆå€¼è¿‡æ»¤
if top_sentence_score < 0.25:  # è¿‡æ»¤ä½ç›¸å…³å¥å­
    continue

# ç»§ç»­åŸæœ‰é€»è¾‘
top_sentence_hash_id = valid_sentence_hash_ids[top_sentence_index]
...
```

**é¢„æœŸæœ€ç»ˆæ•ˆæœ**:
- âœ… é€Ÿåº¦: 3-4ç§’/é—®é¢˜ (ä»æé€Ÿ3-4å€)
- âœ… å‡†ç¡®ç‡: 72-73% (æ¥è¿‘åŸæ°´å¹³)
- âœ… å®Œæˆ1273é—®é¢˜: çº¦1-1.5å°æ—¶

---

## ğŸ“ˆ ä¸åŒå€™é€‰æ± å¤§å°çš„æƒè¡¡

| å€™é€‰æ± å¤§å° | é¢„æœŸé€Ÿåº¦ | é¢„æœŸå‡†ç¡®ç‡ | æ€»æé€Ÿå€æ•° | æ¨èåœºæ™¯ |
|----------|---------|----------|-----------|---------|
| 100 | 1ç§’ | 68% | 14x | å¿«é€ŸåŸå‹ |
| 200 (å½“å‰) | 1.5ç§’ | 70% | 9x | é€Ÿåº¦ä¼˜å…ˆ |
| **300** | **2ç§’** | **71%** | **7x** | **å¹³è¡¡** |
| **500** | **3-4ç§’** | **72-73%** | **4x** | **å‡†ç¡®ç‡ä¼˜å…ˆ(æ¨è)** |
| 1000 | 7-8ç§’ | 73%+ | 2x | æœ€é«˜å‡†ç¡®ç‡ |

---

## ğŸ”§ å…·ä½“å®ç°ä»£ç 

### ä¿®æ”¹1: æ‰©å¤§å€™é€‰æ± 

```python
# src/config.py
candidate_pool_size=500,  # âœ… æ”¹ä¸º500
```

### ä¿®æ”¹2: æ·»åŠ å¥å­ç›¸ä¼¼åº¦é˜ˆå€¼

åœ¨ `src/LinearRAG.py` çš„ `calculate_entity_scores` æ–¹æ³•ä¸­ï¼š

```python
# æ‰¾åˆ° top_sentence_indices = np.argsort... è¿™ä¸€è¡Œå
# åœ¨ for top_sentence_index in top_sentence_indices: å¾ªç¯å†…
# åœ¨ top_sentence_hash_id = ... è¿™è¡Œä¹‹å‰æ·»åŠ :

top_sentence_score = sentence_similarities[top_sentence_index]

# âœ… è¿‡æ»¤ä½ç›¸å…³å¥å­
if top_sentence_score < 0.25:
    continue
```

### ä¿®æ”¹3: é™ä½è¿œè·ç¦»å®ä½“æƒé‡

åŒæ ·åœ¨ `calculate_entity_scores` ä¸­ï¼š

```python
# æ‰¾åˆ° next_entity_score = entity_score * top_sentence_score è¿™ä¸€è¡Œ
# æ”¹ä¸º:

next_entity_score = entity_score * top_sentence_score
# âœ… é™ä½è¿œè·ç¦»å®ä½“æƒé‡
if tier > 1:
    next_entity_score *= 0.7
```

---

## ğŸ“Š ä¼˜åŒ–è·¯çº¿å›¾

### ä»Šå¤© (5åˆ†é’Ÿ)
1. âœ… ä¿®æ”¹ `candidate_pool_size=500`
2. âœ… æµ‹è¯•100ä¸ªé—®é¢˜
3. âœ… éªŒè¯å‡†ç¡®ç‡æ˜¯å¦æ¢å¤åˆ°72%+

### å¦‚æœä»éœ€ä¼˜åŒ– (30åˆ†é’Ÿ)
1. æ·»åŠ å¥å­ç›¸ä¼¼åº¦é˜ˆå€¼è¿‡æ»¤
2. é™ä½è¿œè·ç¦»å®ä½“æƒé‡
3. å†æ¬¡æµ‹è¯•

### æœ€ç»ˆéªŒè¯ (2å°æ—¶)
1. è¿è¡Œå®Œæ•´1273ä¸ªé—®é¢˜
2. å¯¹æ¯”MIRAGE baseline
3. æ’°å†™å®éªŒæŠ¥å‘Š

---

## ğŸ’¡ ç†è®ºåˆ†æ

### ä¸ºä»€ä¹ˆå€™é€‰æ± =200å¯¼è‡´å‡†ç¡®ç‡ä¸‹é™ï¼Ÿ

1. **è¦†ç›–ç‡ä¸è¶³**
   - åŒ»ç–—é—®ç­”å¾€å¾€éœ€è¦å¤šè·³æ¨ç†
   - ç›¸å…³æ–‡æ¡£å¯èƒ½æ’åœ¨200åä¹‹å
   - ç‰¹åˆ«æ˜¯å¤æ‚ç–¾ç—…å’Œç½•è§ç—…ä¾‹

2. **å®ä½“æ‰©æ•£å—é™**
   - å€™é€‰æ± å° â†’ å¯æ‰©æ•£çš„å®ä½“å°‘
   - é™åˆ¶äº†å¤šè·³æ¨ç†èƒ½åŠ›
   - LinearRAGçš„æ ¸å¿ƒä¼˜åŠ¿æœªå®Œå…¨å‘æŒ¥

3. **è§£å†³æ–¹æ¡ˆ**
   - æ‰©å¤§å€™é€‰æ±  â†’ ä¿ç•™æ›´å¤šæ½œåœ¨ç›¸å…³æ–‡æ¡£
   - æé«˜è¿‡æ»¤è´¨é‡ â†’ å‡å°‘å™ªå£°
   - è‡ªé€‚åº”è°ƒæ•´ â†’ å¤æ‚é—®é¢˜ç”¨å¤§æ± 

---

## ğŸ¯ æœ€ç»ˆå»ºè®®

**ç«‹å³æ‰§è¡Œ**:
```bash
# 1. ä¿®æ”¹é…ç½®
vim src/config.py  # æ”¹ candidate_pool_size=500

# 2. æµ‹è¯•
python run.py --use_hf_ner ... --questions_limit 100 > medqa_pool500_test.log 2>&1 &

# 3. ç›‘æ§
tail -f medqa_pool500_test.log | grep "Retrieving:"

# 4. éªŒè¯å‡†ç¡®ç‡
grep "Accuracy:" medqa_pool500_test.log
```

**é¢„æœŸç»“æœ**:
- é€Ÿåº¦: 3-4ç§’/é—®é¢˜ âœ…
- å‡†ç¡®ç‡: 72-73% âœ…
- å®Œæˆ1273é—®é¢˜: 1-1.5å°æ—¶ âœ…

---

## ğŸ“š å‚è€ƒåŸºå‡†

MIRAGE MedQA baseline (GPT-4):
- RAG-0: 59.7%
- RAG-2: 61.9%
- RAG-4: 62.8%
- RAG-32: **63.9%**

ä½ çš„ç›®æ ‡: 72-73% (è¿œè¶…baseline!) ğŸ‰

---

**æ€»ç»“**: å€™é€‰æ± =200ç‰ºç‰²äº†3%å‡†ç¡®ç‡æ¢å–9å€æé€Ÿã€‚å»ºè®®æ‰©å¤§åˆ°500ï¼Œåœ¨ä¿æŒ4å€æé€Ÿçš„åŒæ—¶æ¢å¤å‡†ç¡®ç‡ã€‚è¿™æ˜¯æœ€ä¼˜çš„é€Ÿåº¦-å‡†ç¡®ç‡å¹³è¡¡ç‚¹ï¼
